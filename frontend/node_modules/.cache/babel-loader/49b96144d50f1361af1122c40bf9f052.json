{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compileToken = exports.compileUnsafe = exports.compile = void 0;\nvar css_what_1 = require(\"css-what\");\nvar boolbase_1 = __importDefault(require(\"boolbase\"));\nvar sort_js_1 = __importStar(require(\"./sort.js\"));\nvar general_js_1 = require(\"./general.js\");\nvar subselects_js_1 = require(\"./pseudo-selectors/subselects.js\");\n/**\n * Compiles a selector to an executable function.\n *\n * @param selector Selector to compile.\n * @param options Compilation options.\n * @param context Optional context for the selector.\n */\nfunction compile(selector, options, context) {\n  var next = compileUnsafe(selector, options, context);\n  return (0, subselects_js_1.ensureIsTag)(next, options.adapter);\n}\nexports.compile = compile;\nfunction compileUnsafe(selector, options, context) {\n  var token = typeof selector === \"string\" ? (0, css_what_1.parse)(selector) : selector;\n  return compileToken(token, options, context);\n}\nexports.compileUnsafe = compileUnsafe;\nfunction includesScopePseudo(t) {\n  return t.type === css_what_1.SelectorType.Pseudo && (t.name === \"scope\" || Array.isArray(t.data) && t.data.some(function (data) {\n    return data.some(includesScopePseudo);\n  }));\n}\nvar DESCENDANT_TOKEN = {\n  type: css_what_1.SelectorType.Descendant\n};\nvar FLEXIBLE_DESCENDANT_TOKEN = {\n  type: \"_flexibleDescendant\"\n};\nvar SCOPE_TOKEN = {\n  type: css_what_1.SelectorType.Pseudo,\n  name: \"scope\",\n  data: null\n};\n/*\n * CSS 4 Spec (Draft): 3.4.1. Absolutizing a Relative Selector\n * http://www.w3.org/TR/selectors4/#absolutizing\n */\nfunction absolutize(token, _a, context) {\n  var adapter = _a.adapter;\n  // TODO Use better check if the context is a document\n  var hasContext = !!(context === null || context === void 0 ? void 0 : context.every(function (e) {\n    var parent = adapter.isTag(e) && adapter.getParent(e);\n    return e === subselects_js_1.PLACEHOLDER_ELEMENT || parent && adapter.isTag(parent);\n  }));\n  for (var _i = 0, token_1 = token; _i < token_1.length; _i++) {\n    var t = token_1[_i];\n    if (t.length > 0 && (0, sort_js_1.isTraversal)(t[0]) && t[0].type !== css_what_1.SelectorType.Descendant) {\n      // Don't continue in else branch\n    } else if (hasContext && !t.some(includesScopePseudo)) {\n      t.unshift(DESCENDANT_TOKEN);\n    } else {\n      continue;\n    }\n    t.unshift(SCOPE_TOKEN);\n  }\n}\nfunction compileToken(token, options, context) {\n  var _a;\n  token.forEach(sort_js_1.default);\n  context = (_a = options.context) !== null && _a !== void 0 ? _a : context;\n  var isArrayContext = Array.isArray(context);\n  var finalContext = context && (Array.isArray(context) ? context : [context]);\n  // Check if the selector is relative\n  if (options.relativeSelector !== false) {\n    absolutize(token, options, finalContext);\n  } else if (token.some(function (t) {\n    return t.length > 0 && (0, sort_js_1.isTraversal)(t[0]);\n  })) {\n    throw new Error(\"Relative selectors are not allowed when the `relativeSelector` option is disabled\");\n  }\n  var shouldTestNextSiblings = false;\n  var query = token.map(function (rules) {\n    if (rules.length >= 2) {\n      var first = rules[0],\n        second = rules[1];\n      if (first.type !== css_what_1.SelectorType.Pseudo || first.name !== \"scope\") {\n        // Ignore\n      } else if (isArrayContext && second.type === css_what_1.SelectorType.Descendant) {\n        rules[1] = FLEXIBLE_DESCENDANT_TOKEN;\n      } else if (second.type === css_what_1.SelectorType.Adjacent || second.type === css_what_1.SelectorType.Sibling) {\n        shouldTestNextSiblings = true;\n      }\n    }\n    return compileRules(rules, options, finalContext);\n  }).reduce(reduceRules, boolbase_1.default.falseFunc);\n  query.shouldTestNextSiblings = shouldTestNextSiblings;\n  return query;\n}\nexports.compileToken = compileToken;\nfunction compileRules(rules, options, context) {\n  var _a;\n  return rules.reduce(function (previous, rule) {\n    return previous === boolbase_1.default.falseFunc ? boolbase_1.default.falseFunc : (0, general_js_1.compileGeneralSelector)(previous, rule, options, context, compileToken);\n  }, (_a = options.rootFunc) !== null && _a !== void 0 ? _a : boolbase_1.default.trueFunc);\n}\nfunction reduceRules(a, b) {\n  if (b === boolbase_1.default.falseFunc || a === boolbase_1.default.trueFunc) {\n    return a;\n  }\n  if (a === boolbase_1.default.falseFunc || b === boolbase_1.default.trueFunc) {\n    return b;\n  }\n  return function combine(elem) {\n    return a(elem) || b(elem);\n  };\n}","map":{"version":3,"mappings":"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","names":["compile","selector","options","context","next","compileUnsafe","adapter","exports","token","compileToken","includesScopePseudo","t","type","css_what_1","Pseudo","name","Array","isArray","data","some","DESCENDANT_TOKEN","Descendant","FLEXIBLE_DESCENDANT_TOKEN","SCOPE_TOKEN","absolutize","_a","hasContext","every","e","parent","isTag","getParent","subselects_js_1","token_1","_i","length","unshift","forEach","sort_js_1","isArrayContext","finalContext","relativeSelector","Error","shouldTestNextSiblings","query","map","rules","second","first","Adjacent","Sibling","compileRules","reduce","reduceRules","boolbase_1","falseFunc","previous","rule","rootFunc","trueFunc","a","b","combine","elem"],"sources":["compile.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}