{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compileGeneralSelector = void 0;\nvar attributes_js_1 = require(\"./attributes.js\");\nvar index_js_1 = require(\"./pseudo-selectors/index.js\");\nvar css_what_1 = require(\"css-what\");\nfunction getElementParent(node, adapter) {\n  var parent = adapter.getParent(node);\n  if (parent && adapter.isTag(parent)) {\n    return parent;\n  }\n  return null;\n}\n/*\n * All available rules\n */\nfunction compileGeneralSelector(next, selector, options, context, compileToken) {\n  var adapter = options.adapter,\n    equals = options.equals;\n  switch (selector.type) {\n    case css_what_1.SelectorType.PseudoElement:\n      {\n        throw new Error(\"Pseudo-elements are not supported by css-select\");\n      }\n    case css_what_1.SelectorType.ColumnCombinator:\n      {\n        throw new Error(\"Column combinators are not yet supported by css-select\");\n      }\n    case css_what_1.SelectorType.Attribute:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced attributes are not yet supported by css-select\");\n        }\n        if (!options.xmlMode || options.lowerCaseAttributeNames) {\n          selector.name = selector.name.toLowerCase();\n        }\n        return attributes_js_1.attributeRules[selector.action](next, selector, options);\n      }\n    case css_what_1.SelectorType.Pseudo:\n      {\n        return (0, index_js_1.compilePseudoSelector)(next, selector, options, context, compileToken);\n      }\n    // Tags\n    case css_what_1.SelectorType.Tag:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced tag names are not yet supported by css-select\");\n        }\n        var name_1 = selector.name;\n        if (!options.xmlMode || options.lowerCaseTags) {\n          name_1 = name_1.toLowerCase();\n        }\n        return function tag(elem) {\n          return adapter.getName(elem) === name_1 && next(elem);\n        };\n      }\n    // Traversal\n    case css_what_1.SelectorType.Descendant:\n      {\n        if (options.cacheResults === false || typeof WeakSet === \"undefined\") {\n          return function descendant(elem) {\n            var current = elem;\n            while (current = getElementParent(current, adapter)) {\n              if (next(current)) {\n                return true;\n              }\n            }\n            return false;\n          };\n        }\n        // @ts-expect-error `ElementNode` is not extending object\n        var isFalseCache_1 = new WeakSet();\n        return function cachedDescendant(elem) {\n          var current = elem;\n          while (current = getElementParent(current, adapter)) {\n            if (!isFalseCache_1.has(current)) {\n              if (adapter.isTag(current) && next(current)) {\n                return true;\n              }\n              isFalseCache_1.add(current);\n            }\n          }\n          return false;\n        };\n      }\n    case \"_flexibleDescendant\":\n      {\n        // Include element itself, only used while querying an array\n        return function flexibleDescendant(elem) {\n          var current = elem;\n          do {\n            if (next(current)) return true;\n          } while (current = getElementParent(current, adapter));\n          return false;\n        };\n      }\n    case css_what_1.SelectorType.Parent:\n      {\n        return function parent(elem) {\n          return adapter.getChildren(elem).some(function (elem) {\n            return adapter.isTag(elem) && next(elem);\n          });\n        };\n      }\n    case css_what_1.SelectorType.Child:\n      {\n        return function child(elem) {\n          var parent = adapter.getParent(elem);\n          return parent != null && adapter.isTag(parent) && next(parent);\n        };\n      }\n    case css_what_1.SelectorType.Sibling:\n      {\n        return function sibling(elem) {\n          var siblings = adapter.getSiblings(elem);\n          for (var i = 0; i < siblings.length; i++) {\n            var currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n            if (adapter.isTag(currentSibling) && next(currentSibling)) {\n              return true;\n            }\n          }\n          return false;\n        };\n      }\n    case css_what_1.SelectorType.Adjacent:\n      {\n        if (adapter.prevElementSibling) {\n          return function adjacent(elem) {\n            var previous = adapter.prevElementSibling(elem);\n            return previous != null && next(previous);\n          };\n        }\n        return function adjacent(elem) {\n          var siblings = adapter.getSiblings(elem);\n          var lastElement;\n          for (var i = 0; i < siblings.length; i++) {\n            var currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n            if (adapter.isTag(currentSibling)) {\n              lastElement = currentSibling;\n            }\n          }\n          return !!lastElement && next(lastElement);\n        };\n      }\n    case css_what_1.SelectorType.Universal:\n      {\n        if (selector.namespace != null && selector.namespace !== \"*\") {\n          throw new Error(\"Namespaced universal selectors are not yet supported by css-select\");\n        }\n        return next;\n      }\n  }\n}\nexports.compileGeneralSelector = compileGeneralSelector;","map":{"version":3,"mappings":";;;;;;AAAA;AACA;AAQA;AAEA,SAASA,gBAAgB,CACrBC,IAAiB,EACjBC,OAAmC;EAEnC,IAAMC,MAAM,GAAGD,OAAO,CAACE,SAAS,CAACH,IAAI,CAAC;EACtC,IAAIE,MAAM,IAAID,OAAO,CAACG,KAAK,CAACF,MAAM,CAAC,EAAE;IACjC,OAAOA,MAAM;;EAEjB,OAAO,IAAI;AACf;AAEA;;;AAIA,SAAgBG,sBAAsB,CAClCC,IAAgC,EAChCC,QAA0B,EAC1BC,OAA2C,EAC3CC,OAA2B,EAC3BC,YAA6C;EAErC,WAAO,GAAaF,OAAO,QAApB;IAAEG,MAAM,GAAKH,OAAO,OAAZ;EAEvB,QAAQD,QAAQ,CAACK,IAAI;IACjB,KAAKC,uBAAY,CAACC,aAAa;MAAE;QAC7B,MAAM,IAAIC,KAAK,CAAC,iDAAiD,CAAC;;IAEtE,KAAKF,uBAAY,CAACG,gBAAgB;MAAE;QAChC,MAAM,IAAID,KAAK,CACX,wDAAwD,CAC3D;;IAEL,KAAKF,uBAAY,CAACI,SAAS;MAAE;QACzB,IAAIV,QAAQ,CAACW,SAAS,IAAI,IAAI,EAAE;UAC5B,MAAM,IAAIH,KAAK,CACX,2DAA2D,CAC9D;;QAGL,IAAI,CAACP,OAAO,CAACW,OAAO,IAAIX,OAAO,CAACY,uBAAuB,EAAE;UACrDb,QAAQ,CAACc,IAAI,GAAGd,QAAQ,CAACc,IAAI,CAACC,WAAW,EAAE;;QAE/C,OAAOC,8BAAc,CAAChB,QAAQ,CAACiB,MAAM,CAAC,CAAClB,IAAI,EAAEC,QAAQ,EAAEC,OAAO,CAAC;;IAEnE,KAAKK,uBAAY,CAACY,MAAM;MAAE;QACtB,OAAO,oCAAqB,EACxBnB,IAAI,EACJC,QAAQ,EACRC,OAAO,EACPC,OAAO,EACPC,YAAY,CACf;;IAEL;IACA,KAAKG,uBAAY,CAACa,GAAG;MAAE;QACnB,IAAInB,QAAQ,CAACW,SAAS,IAAI,IAAI,EAAE;UAC5B,MAAM,IAAIH,KAAK,CACX,0DAA0D,CAC7D;;QAGC,UAAI,GAAKR,QAAQ,KAAb;QAEV,IAAI,CAACC,OAAO,CAACW,OAAO,IAAIX,OAAO,CAACmB,aAAa,EAAE;UAC3CC,MAAI,GAAGA,MAAI,CAACN,WAAW,EAAE;;QAG7B,OAAO,SAASO,GAAG,CAACC,IAAiB;UACjC,OAAO7B,OAAO,CAAC8B,OAAO,CAACD,IAAI,CAAC,KAAKF,MAAI,IAAItB,IAAI,CAACwB,IAAI,CAAC;QACvD,CAAC;;IAGL;IACA,KAAKjB,uBAAY,CAACmB,UAAU;MAAE;QAC1B,IACIxB,OAAO,CAACyB,YAAY,KAAK,KAAK,IAC9B,OAAOC,OAAO,KAAK,WAAW,EAChC;UACE,OAAO,SAASC,UAAU,CAACL,IAAiB;YACxC,IAAIM,OAAO,GAAuBN,IAAI;YAEtC,OAAQM,OAAO,GAAGrC,gBAAgB,CAACqC,OAAO,EAAEnC,OAAO,CAAC,EAAG;cACnD,IAAIK,IAAI,CAAC8B,OAAO,CAAC,EAAE;gBACf,OAAO,IAAI;;;YAInB,OAAO,KAAK;UAChB,CAAC;;QAGL;QACA,IAAMC,cAAY,GAAG,IAAIH,OAAO,EAAe;QAC/C,OAAO,SAASI,gBAAgB,CAACR,IAAiB;UAC9C,IAAIM,OAAO,GAAuBN,IAAI;UAEtC,OAAQM,OAAO,GAAGrC,gBAAgB,CAACqC,OAAO,EAAEnC,OAAO,CAAC,EAAG;YACnD,IAAI,CAACoC,cAAY,CAACE,GAAG,CAACH,OAAO,CAAC,EAAE;cAC5B,IAAInC,OAAO,CAACG,KAAK,CAACgC,OAAO,CAAC,IAAI9B,IAAI,CAAC8B,OAAO,CAAC,EAAE;gBACzC,OAAO,IAAI;;cAEfC,cAAY,CAACG,GAAG,CAACJ,OAAO,CAAC;;;UAIjC,OAAO,KAAK;QAChB,CAAC;;IAEL,KAAK,qBAAqB;MAAE;QACxB;QACA,OAAO,SAASK,kBAAkB,CAACX,IAAiB;UAChD,IAAIM,OAAO,GAAuBN,IAAI;UAEtC,GAAG;YACC,IAAIxB,IAAI,CAAC8B,OAAO,CAAC,EAAE,OAAO,IAAI;WACjC,QAASA,OAAO,GAAGrC,gBAAgB,CAACqC,OAAO,EAAEnC,OAAO,CAAC;UAEtD,OAAO,KAAK;QAChB,CAAC;;IAEL,KAAKY,uBAAY,CAAC6B,MAAM;MAAE;QACtB,OAAO,SAASxC,MAAM,CAAC4B,IAAiB;UACpC,OAAO7B,OAAO,CACT0C,WAAW,CAACb,IAAI,CAAC,CACjBc,IAAI,CAAC,UAACd,IAAI;YAAK,cAAO,CAAC1B,KAAK,CAAC0B,IAAI,CAAC,IAAIxB,IAAI,CAACwB,IAAI,CAAC;UAAjC,CAAiC,CAAC;QAC1D,CAAC;;IAEL,KAAKjB,uBAAY,CAACgC,KAAK;MAAE;QACrB,OAAO,SAASC,KAAK,CAAChB,IAAiB;UACnC,IAAM5B,MAAM,GAAGD,OAAO,CAACE,SAAS,CAAC2B,IAAI,CAAC;UACtC,OAAO5B,MAAM,IAAI,IAAI,IAAID,OAAO,CAACG,KAAK,CAACF,MAAM,CAAC,IAAII,IAAI,CAACJ,MAAM,CAAC;QAClE,CAAC;;IAEL,KAAKW,uBAAY,CAACkC,OAAO;MAAE;QACvB,OAAO,SAASC,OAAO,CAAClB,IAAiB;UACrC,IAAMmB,QAAQ,GAAGhD,OAAO,CAACiD,WAAW,CAACpB,IAAI,CAAC;UAE1C,KAAK,IAAIqB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;YACtC,IAAME,cAAc,GAAGJ,QAAQ,CAACE,CAAC,CAAC;YAClC,IAAIxC,MAAM,CAACmB,IAAI,EAAEuB,cAAc,CAAC,EAAE;YAClC,IAAIpD,OAAO,CAACG,KAAK,CAACiD,cAAc,CAAC,IAAI/C,IAAI,CAAC+C,cAAc,CAAC,EAAE;cACvD,OAAO,IAAI;;;UAInB,OAAO,KAAK;QAChB,CAAC;;IAEL,KAAKxC,uBAAY,CAACyC,QAAQ;MAAE;QACxB,IAAIrD,OAAO,CAACsD,kBAAkB,EAAE;UAC5B,OAAO,SAASC,QAAQ,CAAC1B,IAAiB;YACtC,IAAM2B,QAAQ,GAAGxD,OAAO,CAACsD,kBAAmB,CAACzB,IAAI,CAAC;YAClD,OAAO2B,QAAQ,IAAI,IAAI,IAAInD,IAAI,CAACmD,QAAQ,CAAC;UAC7C,CAAC;;QAGL,OAAO,SAASD,QAAQ,CAAC1B,IAAiB;UACtC,IAAMmB,QAAQ,GAAGhD,OAAO,CAACiD,WAAW,CAACpB,IAAI,CAAC;UAC1C,IAAI4B,WAAW;UAEf,KAAK,IAAIP,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;YACtC,IAAME,cAAc,GAAGJ,QAAQ,CAACE,CAAC,CAAC;YAClC,IAAIxC,MAAM,CAACmB,IAAI,EAAEuB,cAAc,CAAC,EAAE;YAClC,IAAIpD,OAAO,CAACG,KAAK,CAACiD,cAAc,CAAC,EAAE;cAC/BK,WAAW,GAAGL,cAAc;;;UAIpC,OAAO,CAAC,CAACK,WAAW,IAAIpD,IAAI,CAACoD,WAAW,CAAC;QAC7C,CAAC;;IAEL,KAAK7C,uBAAY,CAAC8C,SAAS;MAAE;QACzB,IAAIpD,QAAQ,CAACW,SAAS,IAAI,IAAI,IAAIX,QAAQ,CAACW,SAAS,KAAK,GAAG,EAAE;UAC1D,MAAM,IAAIH,KAAK,CACX,oEAAoE,CACvE;;QAGL,OAAOT,IAAI;;EACd;AAET;AAvKAsD","names":["getElementParent","node","adapter","parent","getParent","isTag","compileGeneralSelector","next","selector","options","context","compileToken","equals","type","css_what_1","PseudoElement","Error","ColumnCombinator","Attribute","namespace","xmlMode","lowerCaseAttributeNames","name","toLowerCase","attributes_js_1","action","Pseudo","Tag","lowerCaseTags","name_1","tag","elem","getName","Descendant","cacheResults","WeakSet","descendant","current","isFalseCache_1","cachedDescendant","has","add","flexibleDescendant","Parent","getChildren","some","Child","child","Sibling","sibling","siblings","getSiblings","i","length","currentSibling","Adjacent","prevElementSibling","adjacent","previous","lastElement","Universal","exports"],"sources":["general.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}